"use strict";(globalThis.webpackChunkdocs_website=globalThis.webpackChunkdocs_website||[]).push([[4541],{2170:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"system-administration/maintenance/backup-restore","title":"Backup and Restore","description":"Back up and restore your GeoPulse data and configuration.","source":"@site/docs/system-administration/maintenance/backup-restore.md","sourceDirName":"system-administration/maintenance","slug":"/system-administration/maintenance/backup-restore","permalink":"/geopulse/docs/system-administration/maintenance/backup-restore","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Backup and Restore","description":"Back up and restore your GeoPulse data and configuration."},"sidebar":"docsSidebar","previous":{"title":"Updating GeoPulse","permalink":"/geopulse/docs/system-administration/maintenance/updating"},"next":{"title":"Import/Export Data","permalink":"/geopulse/docs/user-guide/interacting-with-data/import-export"}}');var o=n(4848),a=n(8453);const t={title:"Backup and Restore",description:"Back up and restore your GeoPulse data and configuration."},c="Backup and Restore",i={},l=[{value:"What Gets Backed Up?",id:"what-gets-backed-up",level:2},{value:"Manual Backups",id:"manual-backups",level:2},{value:"Creating a Backup",id:"creating-a-backup",level:3},{value:"Restoring from Backup",id:"restoring-from-backup",level:3},{value:"Restore Custom Format Backup",id:"restore-custom-format-backup",level:4},{value:"Restore SQL Format Backup",id:"restore-sql-format-backup",level:4},{value:"Automated Backups",id:"automated-backups",level:2},{value:"Using Cron (Linux/macOS)",id:"using-cron-linuxmacos",level:3},{value:"Using Docker Container (Cross-platform)",id:"using-docker-container-cross-platform",level:3},{value:"Verification and Testing",id:"verification-and-testing",level:2},{value:"Backup Best Practices",id:"backup-best-practices",level:2},{value:"Storage Recommendations",id:"storage-recommendations",level:3},{value:"Retention Strategy",id:"retention-strategy",level:3},{value:"Disaster Recovery",id:"disaster-recovery",level:2},{value:"Complete System Restoration",id:"complete-system-restoration",level:3},{value:"Migration Between Servers",id:"migration-between-servers",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Backup Taking Too Long",id:"backup-taking-too-long",level:3},{value:"Out of Disk Space During Restore",id:"out-of-disk-space-during-restore",level:3},{value:"PostGIS Extensions Issues",id:"postgis-extensions-issues",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"backup-and-restore",children:"Backup and Restore"})}),"\n",(0,o.jsx)(s.p,{children:"Regular backups are essential for protecting your location tracking data. This guide covers everything you need to know about backing up and restoring your GeoPulse installation."}),"\n",(0,o.jsx)(s.h2,{id:"what-gets-backed-up",children:"What Gets Backed Up?"}),"\n",(0,o.jsx)(s.p,{children:"GeoPulse stores all your data in a PostgreSQL database with PostGIS extensions. This includes:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Location points"})," - all GPS coordinates and timestamps"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Visits and trips"})," - processed location data and stay points"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"User accounts"})," - authentication and preferences"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Reverse geocoding cache"})," - address lookups to reduce API calls"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Settings"})," - application configuration"]}),"\n"]}),"\n",(0,o.jsx)(s.admonition,{title:"JWT Keys Don't Need Backup",type:"tip",children:(0,o.jsxs)(s.p,{children:["GeoPulse automatically generates JWT keys on first startup if they don't exist. You don't need to back up the keys from ",(0,o.jsx)(s.code,{children:"/app/keys"})," - if lost, new keys will be generated automatically. Existing users will simply need to log in again."]})}),"\n",(0,o.jsx)(s.h2,{id:"manual-backups",children:"Manual Backups"}),"\n",(0,o.jsx)(s.h3,{id:"creating-a-backup",children:"Creating a Backup"}),"\n",(0,o.jsxs)(s.p,{children:["The simplest way to back up your GeoPulse database is using ",(0,o.jsx)(s.code,{children:"pg_dump"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Create a compressed backup with current timestamp\ndocker exec -t geopulse-postgres pg_dump \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -F c \\\n  -f /tmp/backup.dump\n\n# Copy the backup from container to your host\ndocker cp geopulse-postgres:/tmp/backup.dump \\\n  ./geopulse-backup-$(date +%Y%m%d-%H%M%S).dump\n"})}),"\n",(0,o.jsx)(s.p,{children:"Or create a plain SQL backup:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Plain SQL format (larger but human-readable)\ndocker exec -t geopulse-postgres pg_dump \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  > geopulse-backup-$(date +%Y%m%d-%H%M%S).sql\n"})}),"\n",(0,o.jsx)(s.admonition,{title:"Backup Formats",type:"info",children:(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Custom format (-F c)"}),": Compressed, faster to restore, supports selective restore"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Plain SQL"}),": Larger files but can be inspected and edited with a text editor"]}),"\n"]})}),"\n",(0,o.jsx)(s.h3,{id:"restoring-from-backup",children:"Restoring from Backup"}),"\n",(0,o.jsx)(s.h4,{id:"restore-custom-format-backup",children:"Restore Custom Format Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Stop GeoPulse services\ndocker compose stop geopulse-backend geopulse-ui\n\n# Copy backup into container\ndocker cp ./geopulse-backup.dump geopulse-postgres:/tmp/\n\n# Drop existing database and recreate (WARNING: destroys current data)\ndocker exec -i geopulse-postgres psql -U ${GEOPULSE_POSTGRES_USERNAME} -d postgres <<EOF\nDROP DATABASE ${GEOPULSE_POSTGRES_DB};\nCREATE DATABASE ${GEOPULSE_POSTGRES_DB};\nEOF\n\n# Restore the backup\ndocker exec -i geopulse-postgres pg_restore \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -F c \\\n  -v \\\n  /tmp/backup.dump\n\n# Restart GeoPulse services\ndocker compose start geopulse-backend geopulse-ui\n"})}),"\n",(0,o.jsx)(s.h4,{id:"restore-sql-format-backup",children:"Restore SQL Format Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Stop GeoPulse services\ndocker compose stop geopulse-backend geopulse-ui\n\n# Drop existing database and recreate\ndocker exec -i geopulse-postgres psql -U ${GEOPULSE_POSTGRES_USERNAME} -d postgres <<EOF\nDROP DATABASE ${GEOPULSE_POSTGRES_DB};\nCREATE DATABASE ${GEOPULSE_POSTGRES_DB};\nEOF\n\n# Restore from SQL file\ndocker exec -i geopulse-postgres psql \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  < geopulse-backup.sql\n\n# Restart GeoPulse services\ndocker compose start geopulse-backend geopulse-ui\n"})}),"\n",(0,o.jsx)(s.h2,{id:"automated-backups",children:"Automated Backups"}),"\n",(0,o.jsx)(s.h3,{id:"using-cron-linuxmacos",children:"Using Cron (Linux/macOS)"}),"\n",(0,o.jsx)(s.p,{children:"Create a backup script:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# /usr/local/bin/geopulse-backup.sh\n\nBACKUP_DIR="/var/backups/geopulse"\nRETENTION_DAYS=30\n\nmkdir -p "$BACKUP_DIR"\n\n# Create backup filename with timestamp\nBACKUP_FILE="$BACKUP_DIR/geopulse-$(date +%Y%m%d-%H%M%S).dump"\n\n# Perform backup\ndocker exec -t geopulse-postgres pg_dump \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -F c \\\n  > "$BACKUP_FILE"\n\n# Verify backup was created\nif [ $? -eq 0 ] && [ -f "$BACKUP_FILE" ]; then\n    echo "Backup created successfully: $BACKUP_FILE"\n\n    # Delete backups older than retention period\n    find "$BACKUP_DIR" -name "geopulse-*.dump" -mtime +$RETENTION_DAYS -delete\n    echo "Cleaned up backups older than $RETENTION_DAYS days"\nelse\n    echo "Backup failed!"\n    exit 1\nfi\n'})}),"\n",(0,o.jsx)(s.p,{children:"Make it executable and add to crontab:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Make script executable\nchmod +x /usr/local/bin/geopulse-backup.sh\n\n# Edit crontab\ncrontab -e\n\n# Add daily backup at 2 AM\n0 2 * * * /usr/local/bin/geopulse-backup.sh >> /var/log/geopulse-backup.log 2>&1\n"})}),"\n",(0,o.jsx)(s.h3,{id:"using-docker-container-cross-platform",children:"Using Docker Container (Cross-platform)"}),"\n",(0,o.jsxs)(s.p,{children:["Add a backup service to your ",(0,o.jsx)(s.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-yaml",children:'services:\n  geopulse-backup:\n    image: prodrigestivill/postgres-backup-local:17\n    container_name: geopulse-backup\n    restart: unless-stopped\n    environment:\n      POSTGRES_HOST: geopulse-postgres\n      POSTGRES_DB: ${GEOPULSE_POSTGRES_DB}\n      POSTGRES_USER: ${GEOPULSE_POSTGRES_USERNAME}\n      POSTGRES_PASSWORD: ${GEOPULSE_POSTGRES_PASSWORD}\n      SCHEDULE: "@daily"  # Run daily at midnight\n      BACKUP_KEEP_DAYS: 30\n      BACKUP_KEEP_WEEKS: 4\n      BACKUP_KEEP_MONTHS: 6\n      HEALTHCHECK_PORT: 8080\n    volumes:\n      - ./backups:/backups\n    depends_on:\n      - geopulse-postgres\n'})}),"\n",(0,o.jsx)(s.p,{children:"Then start the backup service:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"docker compose up -d geopulse-backup\n"})}),"\n",(0,o.jsx)(s.h2,{id:"verification-and-testing",children:"Verification and Testing"}),"\n",(0,o.jsx)(s.p,{children:"Always verify your backups are working:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Check backup file size (should not be 0)\nls -lh geopulse-backup.dump\n\n# Verify backup integrity (custom format)\ndocker exec -i geopulse-postgres pg_restore --list /tmp/backup.dump\n\n# Test restore to a temporary database\ndocker exec -i geopulse-postgres psql -U ${GEOPULSE_POSTGRES_USERNAME} -d postgres <<EOF\nCREATE DATABASE geopulse_test;\nEOF\n\ndocker exec -i geopulse-postgres pg_restore \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d geopulse_test \\\n  -F c \\\n  /tmp/backup.dump\n\n# If successful, clean up test database\ndocker exec -i geopulse-postgres psql -U ${GEOPULSE_POSTGRES_USERNAME} -d postgres <<EOF\nDROP DATABASE geopulse_test;\nEOF\n"})}),"\n",(0,o.jsx)(s.h2,{id:"backup-best-practices",children:"Backup Best Practices"}),"\n",(0,o.jsx)(s.h3,{id:"storage-recommendations",children:"Storage Recommendations"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Keep backups off-server"}),": Store backups on a different machine or cloud storage"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Use 3-2-1 rule"}),": 3 copies, 2 different media types, 1 offsite"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Encrypt sensitive backups"}),": Use GPG or similar tools for backups containing location data"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Example encrypted backup:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Create and encrypt backup\ndocker exec -t geopulse-postgres pg_dump \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -F c | gpg --encrypt --recipient your@email.com \\\n  > geopulse-backup-$(date +%Y%m%d).dump.gpg\n\n# Restore encrypted backup\ngpg --decrypt geopulse-backup.dump.gpg | \\\n  docker exec -i geopulse-postgres pg_restore \\\n    -U ${GEOPULSE_POSTGRES_USERNAME} \\\n    -d ${GEOPULSE_POSTGRES_DB} \\\n    -F c\n"})}),"\n",(0,o.jsx)(s.h3,{id:"retention-strategy",children:"Retention Strategy"}),"\n",(0,o.jsx)(s.p,{children:"Configure retention based on your needs:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Daily backups"}),": Keep for 7-30 days"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Weekly backups"}),": Keep for 3-6 months"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Monthly backups"}),": Keep for 1-2 years"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Before upgrades"}),": Always create a backup before updating GeoPulse"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"disaster-recovery",children:"Disaster Recovery"}),"\n",(0,o.jsx)(s.h3,{id:"complete-system-restoration",children:"Complete System Restoration"}),"\n",(0,o.jsx)(s.p,{children:"If you need to restore GeoPulse on a new server:"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Install Docker and Docker Compose"})," on the new server"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.strong,{children:"Clone your GeoPulse configuration"}),":"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Copy your .env file and docker-compose.yml to new server\nscp .env docker-compose.yml newserver:/opt/geopulse/\n"})}),"\n",(0,o.jsxs)(s.ol,{start:"3",children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Start PostgreSQL only"}),":"]}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"cd /opt/geopulse\ndocker compose up -d geopulse-postgres\n"})}),"\n",(0,o.jsxs)(s.ol,{start:"4",children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Restore your backup"}),":"]}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Copy backup to new server\nscp geopulse-backup.dump newserver:/opt/geopulse/\n\n# Restore database\ndocker cp geopulse-backup.dump geopulse-postgres:/tmp/\ndocker exec -i geopulse-postgres pg_restore \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -F c \\\n  /tmp/geopulse-backup.dump\n"})}),"\n",(0,o.jsxs)(s.ol,{start:"5",children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Start all services"}),":"]}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,o.jsxs)(s.ol,{start:"6",children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Verify restoration"}),":"]}),"\n"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'# Check services are running\ndocker compose ps\n\n# Check database connectivity\ndocker exec geopulse-postgres psql \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -c "SELECT COUNT(*) FROM points;"\n'})}),"\n",(0,o.jsx)(s.h2,{id:"migration-between-servers",children:"Migration Between Servers"}),"\n",(0,o.jsx)(s.p,{children:"To move GeoPulse from one server to another:"}),"\n",(0,o.jsxs)(s.ol,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Create backup on source server"})," (see Manual Backups above)"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Transfer backup file"})," to destination server"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Follow disaster recovery steps"})," to restore on new server"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Update DNS/firewall"})," rules to point to new server"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Verify everything works"})," before decommissioning old server"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(s.h3,{id:"backup-taking-too-long",children:"Backup Taking Too Long"}),"\n",(0,o.jsx)(s.p,{children:"If backups are slow with large databases:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Use parallel dump for faster backups (PostgreSQL 17+)\ndocker exec -t geopulse-postgres pg_dump \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -F d \\\n  -j 4 \\\n  -f /tmp/backup-dir\n\n# Copy directory format backup\ndocker cp geopulse-postgres:/tmp/backup-dir ./geopulse-backup/\n"})}),"\n",(0,o.jsx)(s.h3,{id:"out-of-disk-space-during-restore",children:"Out of Disk Space During Restore"}),"\n",(0,o.jsx)(s.p,{children:"Monitor disk space during operations:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Check available space\ndocker exec geopulse-postgres df -h /var/lib/postgresql/data\n\n# Increase docker volume size if needed\ndocker volume inspect postgres-data\n"})}),"\n",(0,o.jsx)(s.h3,{id:"postgis-extensions-issues",children:"PostGIS Extensions Issues"}),"\n",(0,o.jsx)(s.p,{children:"If restore fails with PostGIS errors:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'# Ensure PostGIS extension exists before restore\ndocker exec -i geopulse-postgres psql \\\n  -U ${GEOPULSE_POSTGRES_USERNAME} \\\n  -d ${GEOPULSE_POSTGRES_DB} \\\n  -c "CREATE EXTENSION IF NOT EXISTS postgis;"\n'})}),"\n",(0,o.jsx)(s.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://www.postgresql.org/docs/current/backup.html",children:"PostgreSQL Backup Documentation"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://postgis.net/docs/manual-3.5/using_postgis_dbmanagement.html#backup_restore",children:"PostGIS Backup Best Practices"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://docs.docker.com/storage/volumes/#back-up-restore-or-migrate-data-volumes",children:"Docker Volume Backup Strategies"})}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>c});var r=n(6540);const o={},a=r.createContext(o);function t(e){const s=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);