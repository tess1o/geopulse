# HTTP configuration
quarkus.http.port=8080
quarkus.http.limits.max-form-attribute-size=2147483647
quarkus.http.limits.max-body-size=2147483647
quarkus.http.read-timeout=20m

# PostgreSQL configuration
quarkus.datasource.username=${GEOPULSE_POSTGRES_USERNAME}
quarkus.datasource.password=${GEOPULSE_POSTGRES_PASSWORD}
quarkus.datasource.jdbc.url=${GEOPULSE_POSTGRES_URL}
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.max-size=16
quarkus.datasource.jdbc.acquisition-timeout=60s
quarkus.datasource.jdbc.leak-detection-interval=60s
quarkus.datasource.jdbc.max-lifetime=30m

# Migration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=db/migration
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.out-of-order=true

# Hibernate ORM configuration
quarkus.hibernate-orm.dialect=org.hibernate.dialect.PostgreSQLDialect
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.jdbc.statement-batch-size=${GEOPULSE_IMPORT_BULK_INSERT_BATCH_SIZE:500}

# Transaction configuration for large imports
quarkus.transaction-manager.default-transaction-timeout=600s

#JWT
quarkus.smallrye-jwt.enabled=true
smallrye.jwt.new-token.lifespan=${GEOPULSE_JWT_ACCESS_TOKEN_LIFESPAN:1800}
jwt.refresh-token.lifespan=${GEOPULSE_JWT_REFRESH_TOKEN_LIFESPAN:604800}

smallrye.jwt.new-token.issuer=${GEOPULSE_JWT_ISSUER:http://localhost:8080}
mp.jwt.verify.issuer=${GEOPULSE_JWT_ISSUER:http://localhost:8080}

mp.jwt.verify.publickey.location=${GEOPULSE_JWT_PUBLIC_KEY_LOCATION:file:/app/keys/jwt-public-key.pem}
smallrye.jwt.sign.key.location=${GEOPULSE_JWT_PRIVATE_KEY_LOCATION:file:/app/keys/jwt-private-key.pem}

# CSRF Protection Configuration
quarkus.rest-csrf.token-header-name=X-CSRF-Token
quarkus.rest-csrf.cookie-name=csrf-token
quarkus.rest-csrf.form-field-name=_csrf
quarkus.rest-csrf.cookie-http-only=false
quarkus.rest-csrf.require-form-url-encoded=false
quarkus.rest-csrf.cookie-domain=${GEOPULSE_COOKIE_DOMAIN:}
quarkus.rest-csrf.cookie-force-secure=${GEOPULSE_AUTH_SECURE_COOKIES:false}

quarkus.http.auth.proactive=false
quarkus.http.auth.permission.default.paths=/*
quarkus.http.auth.permission.default.policy=authenticated

quarkus.http.auth.permission.public.paths=/api/auth/*,\
  /api/users/sign-up/status,\
  /api/prometheus/metrics,\
  /api/health,\
  /api/users/register,\
  /api/owntracks,\
  /api/overland,\
  /api/dawarich/*,\
  /api/homeassistant/*,\
  /api/shared/*,\
  /api/geocoding/*
quarkus.http.auth.permission.public.policy=permit

geopulse.auth.secure-cookies=${GEOPULSE_AUTH_SECURE_COOKIES:false}
geopulse.auth.cookie-domain=${GEOPULSE_COOKIE_DOMAIN:}

geopulse.auth.registration.enabled=${GEOPULSE_AUTH_REGISTRATION_ENABLED:true}
geopulse.auth.password-registration.enabled=${GEOPULSE_AUTH_PASSWORD_REGISTRATION_ENABLED:true}
geopulse.auth.oidc.registration.enabled=${GEOPULSE_AUTH_OIDC_REGISTRATION_ENABLED:true}

geopulse.auth.login.enabled=${GEOPULSE_AUTH_LOGIN_ENABLED:true}
geopulse.auth.password-login.enabled=${GEOPULSE_AUTH_PASSWORD_LOGIN_ENABLED:true}
geopulse.auth.oidc.login.enabled=${GEOPULSE_AUTH_OIDC_LOGIN_ENABLED:true}
geopulse.auth.admin-login-bypass.enabled=${GEOPULSE_AUTH_ADMIN_LOGIN_BYPASS_ENABLED:true}

# Admin configuration
geopulse.admin.email=${GEOPULSE_ADMIN_EMAIL:}

# User invitation configuration
# Base URL for generating invitation links (e.g., https://geopulse.example.com)
# If empty, frontend will use window.location.origin
geopulse.invitation.base-url=${GEOPULSE_INVITATION_BASE_URL:}

# Deprecated property, replaced by geopulse.auth.password-registration.enabled
geoupuse.auth.sign-up-enabled=${GEOPULSE_AUTH_SIGN_UP_ENABLED:true}

# JWT Configuration - Quarkus automatically supports both sources:
# 1. Authorization header (Bearer tokens) for API clients
# 2. HTTP-only cookies (access_token) for web application
mp.jwt.token.header=Cookie
mp.jwt.token.cookie=access_token
smallrye.jwt.always-check-authorization=true

# Geocoding Configuration
# Note: These values can be overridden via Admin Panel (stored in system_settings table)
# Database values take precedence over these environment variable defaults

quarkus.native.resources.includes=country-mapper.json

# Primary geocoding provider (nominatim, photon, googlemaps, mapbox)
geocoding.provider.primary=${GEOPULSE_GEOCODING_PRIMARY_PROVIDER:nominatim}

# Fallback geocoding provider (optional)
geocoding.provider.fallback=${GEOPULSE_GEOCODING_FALLBACK_PROVIDER:""}

# Delay between geocoding requests (milliseconds)
geocoding.provider.delay.ms=${GEOPULSE_GEOCODING_DELAY_MS:1000}

# Provider availability flags
geocoding.provider.nominatim.enabled=${GEOPULSE_GEOCODING_NOMINATIM_ENABLED:true}
quarkus.rest-client.nominatim-api.url=${GEOPULSE_GEOCODING_NOMINATIM_URL:https://nominatim.openstreetmap.org}
quarkus.rest-client.nominatim-api.user-agent=GeoPulse/1.14.1 (+https://github.com/tess1o/geopulse)
# Nominatim geocoding language preference (BCP 47 format: en-US, de, uk, ja, etc.)
# If not set, no Accept-Language header will be sent (existing behavior)
geocoding.nominatim.language=${GEOPULSE_GEOCODING_NOMINATIM_LANGUAGE:""}

geocoding.provider.photon.enabled=${GEOPULSE_GEOCODING_PHOTON_ENABLED:false}
quarkus.rest-client.photon-api.url=${GEOPULSE_GEOCODING_PHOTON_URL:https://photon.komoot.io}
# Photon geocoding language preference (BCP 47 format: en-US, de, uk, ja, etc.)
# If not set, no Accept-Language header will be sent (existing behavior)
geocoding.photon.language=${GEOPULSE_GEOCODING_PHOTON_LANGUAGE:""}

geocoding.provider.googlemaps.enabled=${GEOPULSE_GEOCODING_GOOGLE_MAPS_ENABLED:false}
quarkus.rest-client.googlemaps-api.url=https://maps.googleapis.com/maps/api
# API Keys (can also be set via encrypted storage in admin panel)
geocoding.googlemaps.api-key=${GEOPULSE_GEOCODING_GOOGLE_MAPS_API_KEY:""}

geocoding.provider.mapbox.enabled=${GEOPULSE_GEOCODING_MAPBOX_ENABLED:false}
quarkus.rest-client.mapbox-api.url=https://api.mapbox.com
geocoding.mapbox.access-token=${GEOPULSE_GEOCODING_MAPBOX_ACCESS_TOKEN:""}

# Default timeline configs. They can be overwritten by each user individually or via ENV variables
geopulse.timeline.staypoint.use_velocity_accuracy=${GEOPULSE_TIMELINE_STAYPOINT_USE_VELOCITY_ACCURACY:true}
geopulse.timeline.staypoint.velocity.threshold=${GEOPULSE_TIMELINE_STAYPOINT_VELOCITY_THRESHOLD:2.5}
geopulse.timeline.staypoint.accuracy.threshold=${GEOPULSE_TIMELINE_STAYPOINT_ACCURACY_THRESHOLD:60.0}
geopulse.timeline.staypoint.min_accuracy_ratio=${GEOPULSE_TIMELINE_STAYPOINT_MIN_ACCURACY_RATIO:0.5}
geopulse.timeline.staypoint.radius_meters=${GEOPULSE_TIMELINE_STAYPOINT_RADIUS_METERS:50}
geopulse.timeline.staypoint.min_duration_minutes=${GEOPULSE_TIMELINE_STAYPOINT_MIN_DURATION_MINUTES:7}

# Merge staypoints
geopulse.timeline.staypoint.merge.enabled=${GEOPULSE_TIMELINE_STAYPOINT_MERGE_ENABLED:true}
geopulse.timeline.staypoint.merge.max_distance_meters=${GEOPULSE_TIMELINE_STAYPOINT_MERGE_MAX_DISTANCE_METERS:400}
geopulse.timeline.staypoint.merge.max_time_gap_minutes=${GEOPULSE_TIMELINE_STAYPOINT_MERGE_MAX_TIME_GAP_MINUTES:15}

# Trip
geopulse.timeline.trip.detection.algorithm=${GEOPULSE_TIMELINE_TRIP_DETECTION_ALGORITHM:single}

# Travel Classification Configuration
geopulse.timeline.trip.arrival.min_duration_seconds=${GEOPULSE_TIMELINE_TRIP_ARRIVAL_MIN_DURATION_SECONDS:90}
geopulse.timeline.trip.sustained_stop.min_duration_seconds=${GEOPULSE_TIMELINE_TRIP_SUSTAINED_STOP_MIN_DURATION_SECONDS:60}

# Walking (mandatory)
geopulse.timeline.travel.classification.walking.max_avg_speed=${GEOPULSE_TIMELINE_WALKING_MAX_AVG_SPEED:6.0}
geopulse.timeline.travel.classification.walking.max_max_speed=${GEOPULSE_TIMELINE_WALKING_MAX_MAX_SPEED:8.0}

# Car (mandatory) - updated default from 8.0 to 10.0
geopulse.timeline.travel.classification.car.min_avg_speed=${GEOPULSE_TIMELINE_CAR_MIN_AVG_SPEED:10.0}
geopulse.timeline.travel.classification.car.min_max_speed=${GEOPULSE_TIMELINE_CAR_MIN_MAX_SPEED:15.0}
geopulse.timeline.travel.classification.short_distance_km=${GEOPULSE_TIMELINE_SHORT_DISTANCE_KM:1.0}

# Bicycle (optional - disabled by default)
geopulse.timeline.travel.classification.bicycle.enabled=${GEOPULSE_TIMELINE_BICYCLE_ENABLED:false}
geopulse.timeline.travel.classification.bicycle.min_avg_speed=${GEOPULSE_TIMELINE_BICYCLE_MIN_AVG_SPEED:8.0}
geopulse.timeline.travel.classification.bicycle.max_avg_speed=${GEOPULSE_TIMELINE_BICYCLE_MAX_AVG_SPEED:25.0}
geopulse.timeline.travel.classification.bicycle.max_max_speed=${GEOPULSE_TIMELINE_BICYCLE_MAX_MAX_SPEED:35.0}

# Running (optional - disabled by default)
geopulse.timeline.travel.classification.running.enabled=${GEOPULSE_TIMELINE_RUNNING_ENABLED:false}
geopulse.timeline.travel.classification.running.min_avg_speed=${GEOPULSE_TIMELINE_RUNNING_MIN_AVG_SPEED:7.0}
geopulse.timeline.travel.classification.running.max_avg_speed=${GEOPULSE_TIMELINE_RUNNING_MAX_AVG_SPEED:14.0}
geopulse.timeline.travel.classification.running.max_max_speed=${GEOPULSE_TIMELINE_RUNNING_MAX_MAX_SPEED:18.0}

# Train (optional - disabled by default)
geopulse.timeline.travel.classification.train.enabled=${GEOPULSE_TIMELINE_TRAIN_ENABLED:false}
geopulse.timeline.travel.classification.train.min_avg_speed=${GEOPULSE_TIMELINE_TRAIN_MIN_AVG_SPEED:30.0}
geopulse.timeline.travel.classification.train.max_avg_speed=${GEOPULSE_TIMELINE_TRAIN_MAX_AVG_SPEED:150.0}
geopulse.timeline.travel.classification.train.min_max_speed=${GEOPULSE_TIMELINE_TRAIN_MIN_MAX_SPEED:80.0}
geopulse.timeline.travel.classification.train.max_max_speed=${GEOPULSE_TIMELINE_TRAIN_MAX_MAX_SPEED:180.0}
geopulse.timeline.travel.classification.train.max_speed_variance=${GEOPULSE_TIMELINE_TRAIN_MAX_SPEED_VARIANCE:15.0}

# Flight (optional - disabled by default)
geopulse.timeline.travel.classification.flight.enabled=${GEOPULSE_TIMELINE_FLIGHT_ENABLED:false}
geopulse.timeline.travel.classification.flight.min_avg_speed=${GEOPULSE_TIMELINE_FLIGHT_MIN_AVG_SPEED:400.0}
geopulse.timeline.travel.classification.flight.min_max_speed=${GEOPULSE_TIMELINE_FLIGHT_MIN_MAX_SPEED:500.0}

geopulse.timeline.timezone.default=Europe/Kyiv

# Timeline View Item Limit - maximum number of items to load on Timeline page
# For larger datasets, users will be guided to use Timeline Reports
geopulse.timeline.view.item-limit=${GEOPULSE_TIMELINE_VIEW_ITEM_LIMIT:150}

geopulse.favorites.max-distance-from-point=75
geopulse.favorites.max-distance-from-area=15

# Import batch size configuration
geopulse.import.bulk-insert-batch-size=${GEOPULSE_IMPORT_BULK_INSERT_BATCH_SIZE:500}
geopulse.import.merge-batch-size=${GEOPULSE_IMPORT_MERGE_BATCH_SIZE:250}

# GeoJSON streaming parser configuration
# Batch size for streaming GeoJSON imports - aligns with bulk insert batch size for optimal performance
# During streaming, batches are flushed directly to database to minimize memory usage
geopulse.import.geojson.streaming-batch-size=${GEOPULSE_IMPORT_GEOJSON_STREAMING_BATCH_SIZE:500}

# Google Timeline streaming parser configuration
# Batch size for streaming Google Timeline imports - aligns with bulk insert batch size for optimal performance
# During streaming, batches are flushed directly to database to minimize memory usage
geopulse.import.googletimeline.streaming-batch-size=${GEOPULSE_IMPORT_GOOGLETIMELINE_STREAMING_BATCH_SIZE:500}

# Import temp file configuration (for large file handling)
# Files larger than this threshold are saved to temp directory instead of loading into memory
# This prevents OOM errors with large file uploads (500MB+)
geopulse.import.temp-directory=${GEOPULSE_IMPORT_TEMP_DIR:/tmp/geopulse/imports}
geopulse.import.large-file-threshold-mb=${GEOPULSE_IMPORT_LARGE_FILE_THRESHOLD_MB:100}
geopulse.import.temp-file-retention-hours=${GEOPULSE_IMPORT_TEMP_FILE_RETENTION_HOURS:24}

# CORS Configuration - supports multiple origins separated by commas
# Example: http://localhost:5555,http://192.168.1.100:5555,https://your-domain.com
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=${GEOPULSE_UI_URL:http://localhost:5555}
quarkus.http.cors.methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization,Accept,X-CSRF-Token
quarkus.http.cors.exposed-headers=Location,Content-Disposition
quarkus.http.cors.access-control-allow-credentials=true

# Real-time Timeline Processing Configuration
geopulse.timeline.processing.thread-pool-size=${GEOPULSE_TIMELINE_PROCESSING_THREADS:2}
geopulse.timeline.job.interval=${GEOPULSE_TIMELINE_JOB_INTERVAL:5m}
geopulse.timeline.job.delay=${GEOPULSE_TIMELINE_JOB_DELAY:1m}

# GPS Path Simplification Configuration
geopulse.timeline.path.simplification.enabled=${GEOPULSE_TIMELINE_PATH_SIMPLIFICATION_ENABLED:true}
geopulse.timeline.path.simplification.tolerance=${GEOPULSE_TIMELINE_PATH_SIMPLIFICATION_TOLERANCE:15.0}
geopulse.timeline.path.simplification.max_points=${GEOPULSE_TIMELINE_PATH_SIMPLIFICATION_MAX_POINTS:100}
geopulse.timeline.path.simplification.adaptive=${GEOPULSE_TIMELINE_PATH_SIMPLIFICATION_ADAPTIVE:true}

# Data Gap Detection Configuration
geopulse.timeline.data_gap.threshold_seconds=${GEOPULSE_TIMELINE_DATA_GAP_THRESHOLD_SECONDS:10800}
geopulse.timeline.data_gap.min_duration_seconds=${GEOPULSE_TIMELINE_DATA_GAP_MIN_DURATION_SECONDS:1800}

# Gap Stay Inference Configuration
# When enabled, infers a stay instead of creating a data gap when points before/after gap are at same location
geopulse.timeline.gap_stay_inference.enabled=${GEOPULSE_TIMELINE_GAP_STAY_INFERENCE_ENABLED:false}
geopulse.timeline.gap_stay_inference.max_gap_hours=${GEOPULSE_TIMELINE_GAP_STAY_INFERENCE_MAX_GAP_HOURS:24}

# Gap Trip Inference Configuration
# When enabled, infers a trip instead of creating a data gap when distance between points exceeds threshold
# Useful for detecting flights, long-distance trains, or drives where GPS tracking was off
geopulse.timeline.gap_trip_inference.enabled=${GEOPULSE_TIMELINE_GAP_TRIP_INFERENCE_ENABLED:false}
geopulse.timeline.gap_trip_inference.min_distance_meters=${GEOPULSE_TIMELINE_GAP_TRIP_INFERENCE_MIN_DISTANCE_METERS:100000}
geopulse.timeline.gap_trip_inference.min_gap_hours=${GEOPULSE_TIMELINE_GAP_TRIP_INFERENCE_MIN_GAP_HOURS:1}
geopulse.timeline.gap_trip_inference.max_gap_hours=${GEOPULSE_TIMELINE_GAP_TRIP_INFERENCE_MAX_GAP_HOURS:24}

# GPS Point Duplicate Detection Configuration
# DEPRECATED: This setting is used for fallback when per-source threshold is NULL
# For new sources, use the per-source settings below instead
# It will be removed in a future major release
geopulse.gps.duplicate-detection.location-time-threshold-minutes=${GEOPULSE_GPS_DUPLICATE_DETECTION_LOCATION_TIME_THRESHOLD_MINUTES:2}

# Per-source duplicate detection defaults (for new sources)
geopulse.gps.duplicate-detection.enabled=${GEOPULSE_GPS_DUPLICATE_DETECTION_ENABLED:false}
geopulse.gps.duplicate-detection.threshold-minutes=${GEOPULSE_GPS_DUPLICATE_DETECTION_THRESHOLD_MINUTES:2}

# GPS Filtering Configuration (per-source defaults)
# These values are used as defaults when creating new GPS sources
geopulse.gps.filter.inaccurate-data.enabled=${GEOPULSE_GPS_FILTER_INACCURATE_DATA_ENABLED:false}
geopulse.gps.max-allowed-accuracy=${GEOPULSE_GPS_MAX_ALLOWED_ACCURACY:100}
geopulse.gps.max-allowed-speed=${GEOPULSE_GPS_MAX_ALLOWED_SPEED:250}

# MQTT Configuration (optional - only active when GEOPULSE_MQTT_ENABLED=true)
geopulse.mqtt.enabled=${GEOPULSE_MQTT_ENABLED:false}
geopulse.mqtt.broker.host=${GEOPULSE_MQTT_BROKER_HOST:geopulse-mosquitto}
geopulse.mqtt.broker.port=${GEOPULSE_MQTT_BROKER_PORT:1883}
geopulse.mqtt.username=${GEOPULSE_MQTT_USERNAME:geopulse_mqtt_admin}
geopulse.mqtt.password=${GEOPULSE_MQTT_PASSWORD:geopulse_mqtt_pass_123}

# OIDC Configuration
geopulse.oidc.enabled=${GEOPULSE_OIDC_ENABLED:false}
# Callback base URL is optional - if not set or empty, falls back to UI URL (GEOPULSE_UI_URL)
geopulse.oidc.callback-base-url=${GEOPULSE_OIDC_CALLBACK_BASE_URL:}

# Account Linking Security
# When true, automatically links OIDC accounts to existing users with matching emails
# WARNING: Only enable this if you fully trust your OIDC providers to verify email ownership
# Recommended for self-hosted environments with centralized SSO (Keycloak, Authentik, etc.)
# Default: false (requires manual verification via password or existing OIDC provider)
geopulse.oidc.auto-link-accounts=${GEOPULSE_OIDC_AUTO_LINK_ACCOUNTS:false}

# State token configuration
geopulse.oidc.state-token.length=32
geopulse.oidc.state-token.expiry-minutes=10

# Provider metadata caching (24 hours default)
geopulse.oidc.metadata-cache.ttl-hours=24
geopulse.oidc.metadata-cache.max-size=10

# JWKS (signing keys) caching
# Lower TTL recommended to handle provider key rotation
geopulse.oidc.jwks-cache.ttl-hours=${GEOPULSE_OIDC_JWKS_CACHE_TTL_HOURS:24}

# OIDC Cleanup Configuration
geopulse.oidc.cleanup.session-states.enabled=${GEOPULSE_OIDC_CLEANUP_ENABLED:true}

# AI Feature Configuration
geopulse.ai.encryption.key.location=${GEOPULSE_AI_ENCRYPTION_KEY_LOCATION:file:/app/keys/ai-encryption-key.txt}

# Sharing
geopulse.share.base-url=${GEOPULSE_SHARE_BASE_URL:}

# Prometheus Metrics Configuration
quarkus.micrometer.export.prometheus.path=/api/prometheus/metrics
quarkus.datasource.metrics.enabled=true
quarkus.hibernate-orm.metrics.enabled=false

# Custom Prometheus Metrics Configuration
# Note: The Prometheus endpoint is always available at build time.
# Use GEOPULSE_PROMETHEUS_ENABLED to control custom metrics collection at runtime.
geopulse.prometheus.enabled=${GEOPULSE_PROMETHEUS_ENABLED:false}
geopulse.prometheus.refresh-interval=${GEOPULSE_PROMETHEUS_REFRESH_INTERVAL:10m}

# Per-metric-class control (optional - all enabled by default)
geopulse.prometheus.gps-points.enabled=${GEOPULSE_PROMETHEUS_GPS_POINTS_ENABLED:true}
geopulse.prometheus.user-metrics.enabled=${GEOPULSE_PROMETHEUS_USER_METRICS_ENABLED:true}
geopulse.prometheus.timeline.enabled=${GEOPULSE_PROMETHEUS_TIMELINE_ENABLED:true}
geopulse.prometheus.favorites.enabled=${GEOPULSE_PROMETHEUS_FAVORITES_ENABLED:true}
geopulse.prometheus.geocoding.enabled=${GEOPULSE_PROMETHEUS_GEOCODING_ENABLED:true}
geopulse.prometheus.memory.enabled=${GEOPULSE_PROMETHEUS_MEMORY_ENABLED:true}

mp.openapi.extensions.smallrye.openapi=3.0.4
mp.openapi.extensions.smallrye.info.title=GeoPulse API
mp.openapi.extensions.smallrye.info.version=1.14.1
mp.openapi.extensions.smallrye.info.description=GeoPulse backend REST API documentation.
mp.openapi.extensions.smallrye.info.contact.name=tess1o
mp.openapi.extensions.smallrye.info.contact.email=kerriden1@gmail.com

quarkus.smallrye-openapi.security-scheme-name=jwt

quarkus.smallrye-openapi.store-schema-directory=target/openapi/
mp.openapi.servers=/
quarkus.swagger-ui.always-include=false
quarkus.smallrye-openapi.enabled=false


geopulse.owntracks.ping.timestamp.override=${GEOPULSE_OWNTRACKS_PING_TIMESTAMP_OVERRIDE:false}